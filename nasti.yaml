---
greeting: >
  Welcome to the ConsoleDot Go Starter App generator!
  
  Before generating your app please do the following:
    - Ensure you have access to the ephemeral cluster
    - Create a new Quay repo for your app
    - Create a new GitHub repo for your app

  You will need access to the ephemeral cluster to run your app in ephemeral. You will be asked for the URLs to the Quay and GitHub repos as part of this generator script as they are required in multiple places in the code and associated files.

  If you don't have access to the Ephemeral cluster please check out https://consoledot.pages.redhat.com/docs/dev/creating-a-new-app/using-ee/getting-started-with-ees.html and come back to this project later.
  If you don't have a Quay repo either create one yourself on quay.io or create one in app-interface as described here https://gitlab.cee.redhat.com/consoledot/app-interface#create-a-quay-repository-for-an-onboarded-app-app-sreapp-1yml

globals:
  - name: "app_name"
    prompt: "App Name"
    help: "Alpha-numeric. Spaces. No special characters. Example: My Great App"
    validation:
      regex: ^[A-Za-z0-9 ]+$

hooks:
  auto_cleanup: true
  after_script: after_template.sh

mutations:

  - name: "contact_name"
    prompt: "Contact Name"
    help: "The contact name used in the OpenAPI docs"
    replace: "Adam Drew"
    files:
      - "main.go"

  - name: "email"
    prompt: "Contact Email"
    help: "The contact email is used for the contact email in the OpenAPI docs"
    replace: "addrew@redhat.com"
    files:
      - "main.go"
    validation:
      kind: "email"

  - name: "clowdapp_name"
    prompt: "ClowdApp Name"
    help: "The name of your ClowdApp. Should be hyphanated. Example: starter-app."
    replace: "go-starter-app"
    default: "{{ app_name.lower().split(' ') | join('-') }}"
    files:
      - "deploy/clowdapp.yaml"
      - "cdappconfig.json"
    validation:
      kind: "slug"

  - name: "api_path"
    prompt: "ClowdApp api_path"
    help: "The api_path is the root of your api. For example, if your api_path is cool-app then your API will start at /api/cool-app"
    replace: "starter-app-api"
    default: "{{ app_name.lower().split(' ') | join('-') }}"
    files:
      - "cdappconfig.json"
      - "deploy/clowdapp.yaml"
      - "main.go"
      - "routes/api.go"
      - "DERIVED.md"
    validation:
      kind: "slug"
      
  - name: "quay"
    prompt: "Quay Repo"
    help: "The quay repo is the location of your container image. Should be in the form of quay.io/username/repo"
    replace: "quay.io/rh_ee_addrew/consoledot-go-starter-app"
    default: "quay.io/cloudservices/{{ app_name.lower().split(' ') | join('_') }}"
    files:
      - "Makefile"
    validation:
      regex: ^quay\.io/[a-zA-Z0-9_-]+/[a-zA-Z0-9_-]+$

  - name: "github"
    prompt: "Github Repo"
    help: "The github repo is the location of your github repo. Should be in the form of github.com/user_or_org/repo"
    replace: "github.com/RedHatInsights/consoledot-go-starter-app"
    default: "github.com/RedHatInsights/{{ app_name.lower().split(' ') | join('_') }}"
    files:
      - "go.mod"
      - "providers/database/main.go"
      - "routes/api.go"
      - "routes/main.go"
      - "main.go"
      - "main_test.go" 
      - "providers/database/main.go"
      - "providers/main.go"
      - "metrics/main.go"
    validation:
      regex: ^github\.com/[a-zA-Z0-9_-]+/[a-zA-Z0-9_-]+$
  
  - name: "docs_name"
    prompt: "Docs Name"
    help: "Name that appears in docs, startup message, README, etc. Example: Starter App"
    replace: "ConsoleDot Go Starter App API"
    default: "{{ app_name }}"
    files:
      - "main.go"
      - "DERIVED.md"
    validation:
      regex: ^[A-Za-z0-9 ]+$
  
  - name: "deployment_name"
    prompt: "Deployment Name"
    help: "Your application's deployment name. Should be hyphanated. Example: starter-app-deployment."
    replace: "starter-app-depolyment"
    default: "{{ app_name.lower().split(' ') | join('-') }}"
    files:
      - "deploy/clowdapp.yaml"
      - "cdappconfig.json"
      - "config/main.go"
    validation:
      kind: "slug"

  - name: "database_name"
    prompt: "Database Name"
    help: "Name of your database. Should be hyphanated. Example: starter-app-db."
    replace: "starter-app-db"
    default: "{{ app_name.lower().split(' ') | join('-') }}"
    files:
      - "deploy/clowdapp.yaml"
      - "cdappconfig.json"
      - "main_test.go"
      - "compose.yaml"
    validation:
      kind: "slug"